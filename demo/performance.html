<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>performance test</title>


    <style>
        body {
            font-family: sans-serif;
        }

        svg {
            width: 50%;
            overflow: visible;
            border: 1px solid #ccc;
            padding: 5%;
        }



        .grd {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2em;
            height: 95vh;
        }


        .col {
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 0;
            justify-content: flex-start;
        }

        .col * {
            margin-top: 0;
            margin-bottom: 1rem;
        }

        textarea {
            width: 100%;
            display: block;
            min-height: 10em;
            height: 50%;
            flex: 1 1 auto;

        }


        select,
        input[type="text"],
        input[type="range"] {
            width: 100%;
            display: block
        }

        #valLength {
            display: block;

        }

        path {
            fill: none;
            stroke-width: 1%;
            stroke: #000;
        }
    </style>



</head>

<body>


    <div class="grd">
        <div class="col">
            <h3>Get point at length</h3>

            <!-- samples -->
            <p>
                <select id="inputExample" class="inputs">
                </select>
            </p>

            <p><input type="number" value="100" id="inputVertices"></p>

            <h3>Input you pathdata</h3>
            <textarea id="svgInput"></textarea>

        </div>


        <div class="col">
            <svg id="svg" viewBox="0 0 100 100">
                <path class="preview" d="  " />


                <g id="pts1"></g>
                <g id="pts2"></g>
                <g id="pts3"></g>

            </svg>
        </div>



    </div>




    <!-- 
M10000 0 a10000 10000 0 1 1 0 20000 a10000 10000 0 1 1 0 -20000 



<script src="https://cdn.jsdelivr.net/gh/herrstrietzel/svg-getpointatlength@main/getPointAtLengthLookup.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/Kaiido/path2D-inspection@master/build/path2D-inspection.min.js"></script>

-->
<script src="../getPointAtLengthLookup.js"></script>
<script src="../getArea.js"></script>
<script src="path_samples_perf.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/svg-path-properties@1.3.0/dist/svg-path-properties.min.js"></script>



    <script>

        // init
        let path = document.querySelector('path')
        let svg = path.closest('svg')



        /**
         * load samples
         */

        // load examples            
        for (let i = 0; i < samples.length; i++) {
            let sample = samples[i]
            // console.log(sample);

            let key = Object.keys(sample)[0];
            //console.log(key);

            let option = document.createElement("option");
            option.value = sample[key];
            option.innerHTML = key;
            inputExample.append(option);
        }

        let first = inputExample.options[0];
        first.selected = true;
        svgInput.value = first.value;
        let d = svgInput.value
        let vertices = +inputVertices.value;
        path.setAttribute('d', d)

        updateSVG()

        svgInput.addEventListener('input', e => {
            updateSVG();
        })
        inputVertices.addEventListener('input', e => {
            updateSVG();
        })


        /**
         * load samples
        */
        inputExample.addEventListener("input", (e) => {
            // get svg markup
            let example = inputExample.value;
            svgInput.value = example;

            let index = e.target.options.selectedIndex;
            resIdeal = samples[index].res

            d = example;
            svgInput.dispatchEvent(new Event("input"));
        });


        function updateSVG() {
            d = svgInput.value
            path.setAttribute('d', d)
            // adjust viewBox
            let vB = path.getBBox()
            svg.setAttribute('viewBox', [vB.x, vB.y, vB.width, vB.height].join(' '))
            //updateLength()
            testPerf()

        }



        testPerf()
        function testPerf() {

            //let d = path.getAttribute('d')
            vertices = +inputVertices.value;
            let t0, t1, t2;

            let timings = {
                native:[],
                lookup: [],
                properties:[]
            }

            /**
             * native
             */
            t0 = performance.now();
            let pathLengthN = path.getTotalLength()
            t1 = performance.now()
            t2 = t1 - t0;
            console.log('native – get totalLength: ', t2);
            timings.native.push(t2)

            t0 = performance.now();
            let ptsN = []
            for (let i = 0; i < vertices; i++) {
                let pt = path.getPointAtLength(pathLengthN / vertices * i)
                ptsN.push(pt)
            }
            t1 = performance.now()
            t2 = t1 - t0;
            //console.log('native – points at length: ', t2);
            timings.native.push(t2)



            /**
             * path length lookup
             */
            t0 = performance.now();
            //let pathLengthLookup = getPathLengthLookup(d, 12)
            let pathLengthLookup = getPathLengthLookup(d)
            let totalLengthL = pathLengthLookup.totalLength

            t1 = performance.now()
            t2 = t1 - t0;
            //console.log('pathLengthLookup – get totalLength: ', t2, totalLengthL);
            timings.lookup.push(t2)


            t0 = performance.now();
            let ptsL = []
            for (let i = 0; i < vertices; i++) {
                let pt = pathLengthLookup.getPointAtLength(totalLengthL / vertices * i)
                //let pt = pathLengthLookup.getPointAtLengthLookup(totalLengthL / vertices * i)
                ptsL.push(pt)
            }
            t1 = performance.now()
            t2 = t1 - t0;
            //console.log('pathLengthLookup – points at length: ', t2);
            timings.lookup.push(t2)






            /**
             * svg-path-properties
             */

            t0 = performance.now();
            let properties = new svgPathProperties.svgPathProperties(d);
            let totalLengthProps = properties.getTotalLength();
            t1 = performance.now()
            t2 = t1 - t0;
            //console.log('svg-path-properties – get totalLength: ', t2);
            timings.properties.push(t2)


            t0 = performance.now();
            let ptsP = []
            for (let i = 0; i < vertices; i++) {
                let pt = properties.getPointAtLength(totalLengthProps / vertices * i)
                ptsP.push(pt)
            }
            t1 = performance.now()
            t2 = t1 - t0;
            //console.log('svg-path-properties – points at length: ', t2, totalLengthProps);
            timings.properties.push(t2)



            /**
             * render points
             */
            let testPtsP = ''
            ptsP.forEach(pt => {
                testPtsP += `<circle  cx="${pt.x}" cy="${pt.y}" r="0.5%" fill="cyan"/>`
            })
            pts3.innerHTML = testPtsP

            let testPtsL = ''
            ptsL.forEach(pt => {
                testPtsL += `<circle  cx="${pt.x}" cy="${pt.y}" r="0.75%" fill="magenta"/>`
            })
            pts2.innerHTML = testPtsL


            let testPts = ''
            ptsN.forEach(pt => {
                testPts += `<circle  cx="${pt.x}" cy="${pt.y}" r="1.2%" fill="green"/>`
            })
            pts1.innerHTML = testPts


            console.dir( JSON.stringify(timings, null, ' '));


        }




        /**
         * Path2D Inspection
         */


        /*
        t0 = performance.now();
       let path2D = new Path2D(d);
       let pathLength2D = path2D.getTotalLength();

       t1 = performance.now()
       t2 = t1 - t0;
       console.log('pathLength2D – get totalLength: ', t2);

       t0 = performance.now();
       let pts2d = []
       for (let i = 0; i < vertices; i++) {
           let pt = path2D.getPointAtLength(pathLength2D / vertices * i)
           pts2d.push(pt)
       }
       t1 = performance.now()
       t2 = t1 - t0;
       console.log('pathLength2D – points at length: ', t2);
        //console.log(pathLength2D);
        */








        /**
         * simple performance test
         */

        function perfStart() {
            t0 = performance.now();
        }

        function perfEnd(text = '') {
            t1 = performance.now();
            total = t1 - t0;
            console.log(`excecution time ${text}:  ${total} ms`);
            return total;
        }



    </script>

</body>

</html>